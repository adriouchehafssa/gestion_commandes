<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Mon Panier</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container mt-4">
  <h2 class="mb-4">ðŸ›’ Mon panier</h2>

  <!-- Panier vide -->
  <div th:if="${#lists.isEmpty(cartItems)}">
    <p class="text-muted">Votre panier est vide.</p>
    <a href="/user/products" class="btn btn-primary mt-3">Ajouter des produits</a>
  </div>

  <!-- Panier avec produits -->
  <div th:unless="${#lists.isEmpty(cartItems)}">
    <table class="table table-bordered table-striped mt-3">
      <thead>
        <tr>
          <th>Image</th>
          <th>Nom</th>
          <th>Prix (â‚¬)</th>
          <th>QuantitÃ©</th>
          <th>Total</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="item : ${cartItems}">
          <td><img th:src="@{${item.produit.image}}" alt="Image" width="80" height="80" /></td>
          <td th:text="${item.produit.name}">Nom</td>
          <td th:text="${item.produit.price}">0.00</td>
          <td th:text="${item.quantity}">1</td>
          <td th:text="${item.produit.price * item.quantity}">0.00</td>
          <td>
            <form th:action="@{/cart/increase}" method="post" style="display:inline;">
              <input type="hidden" th:name="panierId" th:value="${item.id}" />
              <button type="submit" class="btn btn-sm btn-success">+</button>
            </form>

            <form th:action="@{/cart/decrease}" method="post" style="display:inline;">
              <input type="hidden" th:name="panierId" th:value="${item.id}" />
              <button type="submit" class="btn btn-sm btn-warning">-</button>
            </form>

            <form th:action="@{/cart/remove}" method="post" style="display:inline;">
              <input type="hidden" th:name="panierId" th:value="${item.id}" />
              <button type="submit" class="btn btn-sm btn-danger">Supprimer</button>
            </form>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Total gÃ©nÃ©ral -->
    <div class="text-end fs-5 fw-semibold mb-3">
      Total gÃ©nÃ©ral : 
      <span th:text="${#numbers.formatDecimal(total, 1, 'POINT', 2, 'COMMA')} + ' â‚¬'">0.00 â‚¬</span>
    </div>

    <!-- Bouton pour ouvrir la modal de confirmation -->
    <div class="d-flex justify-content-between">
      <a href="/user/products" class="btn btn-secondary">Continuer les achats</a>

      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#checkoutModal">
        âœ… Valider le panier
      </button>
    </div>
  </div>
</div>

<!-- Modal Bootstrap -->
<div class="modal fade" id="checkoutModal" tabindex="-1" aria-labelledby="checkoutModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- FORMULAIRE POST pour valider la commande -->
      <form th:action="@{/cart/confirm}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="modal-header">
          <h5 class="modal-title" id="checkoutModalLabel">Confirmer la commande</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="adresseLivraison" class="form-label">Adresse de livraison :</label>
            <input type="text" class="form-control" id="adresseLivraison" name="adresseLivraison" required />
          </div>
          <div class="mb-3">
            <label for="modeLivraison" class="form-label">Mode de livraison :</label>
            <select class="form-select" id="modeLivraison" name="modeLivraison" required>
              <option value="Standard">Standard</option>
              <option value="Express">Express</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="moyenPaiement" class="form-label">Moyen de paiement :</label>
            <select class="form-select" id="moyenPaiement" name="moyenPaiement" required>
              <option value="Carte bancaire">Carte bancaire</option>
              <option value="PayPal">PayPal</option>
              <option value="Ã€ la livraison">Ã€ la livraison</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-primary">Confirmer la commande</button>
        </div>
      </form>
    </div>
  </div>
</div>

</body>
</html>
